var config={moduleTemplate:[{id:"jt_01",title:"搜索框",img:""},{id:"jt_02",title:"网站推荐",img:""},{id:"jt_03",title:"生活推荐",img:""}],tags:{a:{title:{desc:"标题(seo)",type:"text"},href:{desc:"链接",type:"text"},innerHTML:{desc:"标题",type:"text"}},img:{src:{desc:"图片链接",type:"file"},alt:{desc:"图片介绍",type:"text"}},p:{innerHTML:{desc:"输入文字",type:"text"}}},editProps:{},modify:{}},events=function(e,t){$("#jtc_main").on("mouseenter","a",function(){handle.addHoverShadow(this)}),$("#jtc_main").on("mouseleave","a",function(){handle.removeHoverShadow(this)}),$("#jtc_main").on("click","a",function(e){e.preventDefault()}),$("#jtc_main").on("contextmenu",function(e){e.preventDefault();var t,i,n=$(".hover-shadow"),o=n.offset(),a=utils.getValidWidth(n),d=$("#edit_menu"),s=$("#virtual_phone"),l=s.offset();handle.changeEditOpen(n),t=o.left+a-l.left-10,i=o.top+s.scrollTop()-l.top-10,s.width()-t<88&&(t=t-a-88),d.css({left:t,top:i}).show()}),$(t).on("keydown",function(e){if(console.log(e,"e"),e.shiftKey)switch(e.keyCode){case 37:handle.prevNodeFocus();break;case 38:handle.parentNodeFocus();break;case 39:handle.nextNodeFocus();break;case 40:handle.childNodeFocus()}}),$("#jtc_main").on("dblclick",function(e){utils.hasATag($(this))}),$("#template_module").on("click",".item",function(){var e=$(this).data("id"),t=utils.jsTemplate(e,{});$("#jtc_main").append(t)}),$("#edit_menu").on("click",".item",function(){$(this).hasClass("j_edit_modify")?handle.editModify():$(this).hasClass("j_edit_delete")?handle.editDelete():$(this).hasClass("j_edit_clone")?handle.editClone():$(this).hasClass("j_edit_up")?handle.editUp():$(this).hasClass("j_edit_down")?handle.editDown():$(this).hasClass("j_edit_close")&&handle.editClose(),$("#edit_menu").hide()}),$("#edit_box").on("focus","input",function(){var e=$(this).data("map");$(handle.editModifyMap[e]).addClass("edit_focus")}),$("#edit_box").on("blur","input",function(){$(".edit_focus").removeClass("edit_focus")}),$("#edit_box").on("keyup","input",function(){var e=$(this).data("map"),t=$(this).data("key"),i=handle.editModifyMap[e];$(i).addClass("edit_focus"),i[t]=$(this).val()})}(window,document),handle={editOpenDom:null,addHoverShadow:function(e){$(".hover-shadow").removeClass("hover-shadow"),$(e).addClass("hover-shadow")},removeHoverShadow:function(){$(".hover-shadow").removeClass("hover-shadow")},editModifyMap:[],editModify:function(){var e=this.editOpenDom.find("*").andSelf(),t=0,i=e.length,n=config.tags,o="",a=0;for(this.editModifyMap=[];i>t;t++){var d=e.eq(t).get(0).tagName.toLocaleLowerCase(),s=!e.eq(t).children().length&&e.eq(t).text().trim().length;if(n.hasOwnProperty(d)){this.editModifyMap.push(e.eq(t).get(0));for(var l in n[d]){var h=n[d][l];o+='<div class="item">'+h.desc+'<input data-key="'+l+'" data-map="'+a+'" type="'+h.type+'" /></div>'}a++}else if(s){var c=e.eq(t).text();this.editModifyMap.push(e.eq(t).get(0)),o+='<div class="item">'+c+'<input data-key="innerHTML" data-map="'+a+'" type="text" value="'+c+'" /></div>',a++}}$("#edit_box").html(o)},editDelete:function(){var e=this.getValidDom(this.editOpenDom);e.remove(),this.editClose()},editClone:function(){var e=this.getValidDom(this.editOpenDom);e.after(e.clone()),this.editClose()},editUp:function(){var e=this.getValidDom(this.editOpenDom),t=e.prev();t.length&&t.before(e),this.editClose()},editDown:function(){var e=this.getValidDom(this.editOpenDom),t=e.next();t.length&&t.after(e),this.editClose()},editClose:function(){$(".edit_open").removeClass("edit_open"),$("#virtual_phone").removeClass("edit-open")},getValidDom:function(e){for(;0===e.siblings().length&&!e.hasClass("jtc-card");)e=e.parent();return e},changeEditOpen:function(e){$(".edit_open").removeClass("edit_open"),e.addClass("edit_open"),$("#virtual_phone").addClass("edit-open"),this.editOpenDom=e},prevNodeFocus:function(){this.editOpenDom.prev().length&&this.changeEditOpen(this.editOpenDom.prev())},parentNodeFocus:function(){"jtc_main"!==this.editOpenDom.parent().get(0).id&&this.changeEditOpen(this.editOpenDom.parent())},nextNodeFocus:function(){this.editOpenDom.next().length&&this.changeEditOpen(this.editOpenDom.next())},childNodeFocus:function(){this.editOpenDom.children().length&&this.changeEditOpen(this.editOpenDom.children().eq(0))}},main={init:function(){this.initTemplateModule()},initTemplateModule:function(){for(var e=0,t=config.moduleTemplate,i=t.length,n="";i>e;e++)n+='<div class="item" data-id="'+t[e].id+'">'+t[e].title+"</div>";$("#template_module").html(n)}};main.init();var utils={hasATag:function(e){for(var t=!1;!e.hasClass("jtc-card");){if("A"===e[0].tagName){t=!0;break}if(e=e.parent(),"HTML"===e[0].tagName)break}return t},hasNodeText:function(){},getValidWidth:function(e){for(;0===e.width();)e=e.children();return e.width()?e.width():0},jsTemplate:function(){var e={},t=function i(t,n){var o=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):e[t]=e[t]||i(document.getElementById(t).innerHTML);return n?o(n):o};return t}()};